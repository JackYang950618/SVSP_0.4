<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>企业列表</title>
    <script src="js/jquery/2.0.0/jquery.min.js"></script>
    <link href="css/bootstrap/3.3.6/bootstrap.min.css" rel="stylesheet">
    <script src="js/bootstrap/3.3.6/bootstrap.min.js"></script>
    <script src="js/data-format.js"></script>
    <link href="css/dashboard.css" rel="stylesheet">
    <link href="css/dropdown-submenu.css" rel="stylesheet">
    <link href="css/bootstrap/navbar.css" rel="stylesheet">
    <script src="js/bootstrap/navbar.js"></script>
    <script src="js/time.js"></script>
    <script src="js/util.js"></script>
</head>
<script type="text/javascript">
    $('#embed').load('embed/loginLogModal.html');

    var currentPage = 1;                          //当前页数

    /**
     * 返回count值
     * */
    function countValue(){
        var mySelect=document.getElementById("count");
        var index=mySelect.selectedIndex;
        return mySelect.options[index].text;
    }
    /**
     * 计算总页数
     * */
    function totalPage() {
        var totalRecord = 0;
        $.ajax({
            type: "POST",                       // 方法类型
            url: "totalRecord",                  // url
            async: false,                      // 同步：意思是当有返回值以后才会进行后面的js程序
            dataType: "json",
            success: function (result) {
                if (result > 0) {
                    totalRecord = result;
                } else {
                    console.log("fail: " + result);
                    totalRecord = 0;
                }
            },
            error: function (result) {
                console.log("error: " + result);
                totalRecord = 0;
            }
        });
        var count = countValue();                         // 可选
        var total = loadPages(totalRecord, count);
        return total;
    }

    /**
     * 设置克隆页码
     * */
    function setPageClone(result) {
        $(".beforeClone").remove();
        setClientList(result);
        var total = totalPage();
        $("#next").prev().hide();
        var st = "共" + total + "页";
        $("#totalPage").text(st);
        var myArray = new Array();
        for (var i = 0; i < total; i++) {
            var li = $("#next").prev();
            myArray[i] = i + 1;
            var clonedLi = li.clone();
            clonedLi.show();
            clonedLi.find('a:first-child').text(myArray[i]);
            clonedLi.find('a:first-child').click(function () {
                var num = $(this).text();
                switchPage(num);
            });
            clonedLi.addClass("beforeClone");
            clonedLi.removeAttr("id");
            clonedLi.insertAfter(li);
        }

    }

    /**
     * 点击页数跳转页面
     * @param pageNumber 跳转页数
     * */
    function switchPage(pageNumber) {
        console.log("当前页：" + pageNumber);
        if (pageNumber == 0) {                 //首页
            pageNumber = 1;
        }
        if (pageNumber == -2) {
            pageNumber = totalPage();        //尾页
        }
        if (pageNumber == null || pageNumber == undefined) {
            console.log("参数为空,返回首页!");
            pageNumber = 1;
        }
        $("#current").find("a").text("当前页："+pageNumber);
        if (pageNumber == 1) {
            $("#previous").addClass("disabled");
            $("#firstPage").addClass("disabled");
            $("#next").removeClass("disabled");
            $("#endPage").removeClass("disabled");
        }
        if (pageNumber == totalPage()) {
            $("#next").addClass("disabled");
            $("#endPage").addClass("disabled");
            $("#previous").removeClass("disabled");
            $("#firstPage").removeClass("disabled");
        }
        if(pageNumber > 1){
            $("#previous").removeClass("disabled");
            $("#firstPage").removeClass("disabled");
        }
        if(pageNumber < totalPage()){
            $("#next").removeClass("disabled");
            $("#endPage").removeClass("disabled");
        }
        var page = {};
        page.count = countValue();                        //可选
        page.pageNumber = pageNumber;
        currentPage = pageNumber;          //当前页面
        //addClass("active");
        page.start = (pageNumber - 1) * page.count;
        $.ajax({
            type: "POST",                       // 方法类型
            url: "loadPageClientList",         // url
            async: false,                      // 同步：意思是当有返回值以后才会进行后面的js程序
            data: JSON.stringify(page),
            dataType: "json",
            contentType: 'application/json;charset=utf-8',
            success: function (result) {
                if (result != undefined) {
                    setClientList(result);
                } else {
                    console.log("fail: " + result);
                }
            },
            error: function (result) {
                console.log("error: " + result);
            }
        });
    }

    /**
     * 输入页数跳转页面
     * */
    function inputSwitchPage() {
        var pageNumber = $("#pageNumber").val();    // 获取输入框的值
        $("#current").find("a").text("当前页："+pageNumber);
        if (pageNumber == null || pageNumber == undefined) {
            window.alert("跳转页数不能为空！")
        } else {
            if (pageNumber == 1) {
                $("#previous").addClass("disabled");
                $("#firstPage").addClass("disabled");
                $("#next").removeClass("disabled");
                $("#endPage").removeClass("disabled");
            }
            if (pageNumber == totalPage()) {
                $("#next").addClass("disabled");
                $("#endPage").addClass("disabled");
                $("#previous").removeClass("disabled");
                $("#firstPage").removeClass("disabled");
            }
            if(pageNumber > 1){
                $("#previous").removeClass("disabled");
                $("#firstPage").removeClass("disabled");
            }
            if(pageNumber < totalPage()){
                $("#next").removeClass("disabled");
                $("#endPage").removeClass("disabled");
            }
            currentPage = pageNumber;
            var page = {};
            page.count = countValue();//可选
            page.pageNumber = pageNumber;
            page.start = (pageNumber - 1) * page.count;
            $.ajax({
                type: "POST",                       // 方法类型
                url: "loadPageClientList",         // url
                async: false,                      // 同步：意思是当有返回值以后才会进行后面的js程序
                data: JSON.stringify(page),
                dataType: "json",
                contentType: 'application/json;charset=utf-8',
                success: function (result) {
                    if (result != undefined) {
                        console.log(result);
                        setClientList(result);
                    } else {
                        console.log("fail: " + result);
                    }
                },
                error: function (result) {
                    console.log("error: " + result);
                }
            });


        }
    }

    /**
     * 分页 获取首页内容
     * */
    function loadPageClientList() {
        var pageNumber = 1;               // 显示首页
        $("#current").find("a").text("当前页：1");
        $("#previous").addClass("disabled");
        $("#firstPage").addClass("disabled");
        var page = {};
        page.count = countValue();                                 // 可选
        page.pageNumber = pageNumber;
        page.start = (pageNumber - 1) * page.count;
        $.ajax({
            type: "POST",                       // 方法类型
            url: "loadPageClientList",          // url
            async: false,                       // 同步：意思是当有返回值以后才会进行后面的js程序
            data: JSON.stringify(page),
            dataType: "json",
            contentType: 'application/json;charset=utf-8',
            success: function (result) {
                if (result != undefined) {
                    console.log(result);
                    setPageClone(result);
                } else {
                    console.log("fail: " + result);
                }
            },
            error: function (result) {
                console.log("error: " + result);
                console.log("失败");
            }
        });
    }

    /**
     * 计算分页总页数
     * @param totalRecord
     * @param count
     * @returns {number}
     */
    function loadPages(totalRecord, count) {
        if (totalRecord == 0) {
            window.alert("总记录数为0，请检查！");
            return 0;
        }
        else if (totalRecord % count == 0)
            return totalRecord / count;
        else
            return parseInt(totalRecord / count) + 1;
    }

    function setClientList(result) {
        // 获取id为cloneTr的tr元素
        var tr = $("#cloneTr");
        tr.siblings().remove();
        $.each(result, function (index, item) {
            // 克隆tr，每次遍历都可以产生新的tr
            var clonedTr = tr.clone();
            clonedTr.show();
            var _index = index;
            // 循环遍历cloneTr的每一个td元素，并赋值
            clonedTr.children("td").each(function (inner_index) {
                var obj = eval(item);
                // 根据索引为部分td赋值
                switch (inner_index) {
                    // 企业编号
                    case (0):
                        $(this).html(obj.clientId);
                        break;
                    // 企业名称
                    case (1):
                        $(this).html(obj.companyName);
                        break;
                    // 由谁添加
                    case (2):
                        $(this).html(obj.contactName);
                        break;
                    // 添加时间
                    case (3):
                        $(this).html(getNowDate());
                        break;
                    // 编辑时间
                    case (4):
                        $(this).html(getNowDate());
                        break;
                    // 操作
                    case (5):

                        break;
                }
            });
            // 把克隆好的tr追加到原来的tr前面
            clonedTr.removeAttr("id");
            clonedTr.insertBefore(tr);
        });
        // 隐藏无数据的tr
        tr.hide();
    }
    function loadClientList() {
        $.ajax({
            type: "POST",                       // 方法类型
            url: "listClient",                  // url
            async : false,                      // 同步：意思是当有返回值以后才会进行后面的js程序
            dataType: "json",
            success: function (result) {
                if (result != undefined) {
                    console.log(result);
                    setClientList(result);
                } else {
                    console.log("fail: " + result);
                }
            },
            error:function (result) {
                console.log("error: " + result);
            }
        });
    }
    var m = new Date();
    var month = m.getMonth();
    var y = new Date();
    var year = y.getFullYear();
    //当月的第几周
    var getMonthWeek = function (a, b, c) {
        //a = d = 当前日期
        //b = 6 - w = 当前周的还有几天过完(不算今天)
        //a + b 的和在除以7 就是当天是当前月份的第几周
        var date = new Date(a, parseInt(b) - 1, c), w = date.getDay(), d = date.getDate();
        return Math.ceil((d + 6 - w) / 7);
    };
    $(".week").text(getMonthWeek());
    $(".month").text(month);
    $(".year").text(year);
    console.log(getMonthWeek()+month+year);
</script>
<body onload="loadPageClientList()">
    <!--导航条-->
    <nav class="navbar navbar-inverse navbar-fixed-top float" id="navbar1" style="height: 50px;">
        <div class="main-title">
            <ul class="nav navbar-nav navbar-left navbar-side">
                <li>
                    <a href="#" onclick="$('body').toggleClass('sidebar-collapse');" style="width: 50px">
                        <span class="glyphicon glyphicon-menu-hamburger"></span>
                    </a>
                </li>
            </ul>
        </div>
        <div class="container navbar-left" style="width: 800px;">
            <div class="navbar-header">
                <a class="navbar-brand" href="#"><img src="image/logo2.png"></a>
            </div>
            <div id="navbar" class="collapse navbar-collapse" style="margin-left: 150px;">
                <ul class="nav navbar-nav">
                    <li><a href="#">首页</a></li>
                    <li class="active"><a href="weekPlan.html">配伍周计划</a></li>
                    <li><a href="#">物料需求单</a></li>
                    <li><a href="#">生产计划单</a></li>
                    <li><a href="thresholdTable.html">基础数据阈值表</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
        <ul class="nav navbar-nav navbar-right">
            <li><a href="#" title="提醒"><span class="glyphicon glyphicon-bell"></span></a></li>
            <li><a href="#" title="事项"><span class="glyphicon glyphicon-envelope"></span></a></li>
            <li class="dropdown">
                <a href="#" title="我的" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-user"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="#">个人信息</a></li>
                    <li><a href="#">待办事项</a></li>
                    <li><a href="#" onclick="showLog();">登录日志</a></li>
                    <li><a href="index.html">注销</a></li>
                </ul>
            </li>
        </ul>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="sidebar">
                <!--<h4>博客管理系统(四月)</h4>-->
                <!--<div class="cover">-->
                <!--<h4><img class="img-circle" src="image/icons.png"/></h4>-->
                <!--<b>Hi~ 小主</b>-->
                <!--<p>超级管理员</p>-->
                <!--</div>-->
                <ul class="sidenav animated fadeInUp">
                    <!--<li><a href="#"><span class="glyphicon glyphicon-backward" aria-hidden="true"></span></a></li>-->
                    <li><a class="withripple" href="wastesPlatform.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;系统概览 </span><span class="iright pull-right">&gt;</span><span class="sr-only">(current)</span></a></li>
                    <li><a class="withripple" href="businessModel.html"><span class="glyphicon glyphicon-user" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;商务管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li class="active"><a class="withripple" href="compatibilityPlan.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;配伍计划 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="receiveManagement.html"><span class="glyphicon glyphicon-log-in" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;接收管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="storageManagement.html"><span class="glyphicon glyphicon-save" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;贮存管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="preprocessingManagement.html"><span class="glyphicon glyphicon-sort-by-attributes-alt" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;预备管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="dispositionManagement.html"><span class="glyphicon glyphicon-retweet" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;处置管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="secondaryManagement.html"><span class="glyphicon glyphicon-tags" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;次生管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="procurementManagement.html"><span class="glyphicon glyphicon-indent-right" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;采购管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="reportManagement.html"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;报表管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="basicData.html"><span class="glyphicon glyphicon-signal" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;基础数据 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="#"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;系统设置 </span><span class="iright pull-right">&gt;</span></a></li>
                </ul>
            </div>
        </div>

        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main ">
            <div class="row">
                <div>
                    <ol class="breadcrumb">
                        <li><a href="businessModel.html">配伍计划</a></li>
                        <li class="active">配伍周计划</li>
                    </ol>
                </div>
                <h4 class="sub-header">配伍周计划</h4>
            </div>
            <div class="row">
                <div>
                    <!--操作按钮-->
                    <div class="pull-left col-md-6">
                        <a class="btn btn-primary btn-xs" href="newWarehouse.html"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 新增</a>
                        <a class="btn btn-primary btn-xs" onclick=""><span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span> 导出</a>
                    </div>
                    <!--查询框-->
                    <div class="input-group col-xs-3 pull-right">
                        <input type="text" class="form-control" placeholder="搜索..." id="searchContent">
                        <span class="input-group-btn">
                            <a class="btn btn-default" onclick="searchTest();"><span class="glyphicon glyphicon-search" aria-hidden="true"></span> 查询</a>
                            <a class="btn btn-default" onclick="$('#senior').toggle();"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span> 高级查询</a>
                        </span>
                    </div>
                </div>
            </div>
            <div class="panel panel-default" id="senior" style="display: none;">
                <div class="panel-body">
                    <div class="row">
                        <div class="form-horizontal col-md-3">
                            <div class="form-group">
                                <label for="search-questionnaireId" class="col-sm-4 control-label">调查表编号</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="search-questionnaireId" name="search-questionnaireId" placeholder="">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="search-companyName" class="col-sm-4 control-label">企业名称</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="search-companyName" name="search-companyName" placeholder="">
                                </div>
                            </div>
                        </div>
                        <div class="form-horizontal col-md-3">
                            <div class="form-group">
                                <label for="search-industry" class="col-sm-4 control-label">所属行业</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="search-industry" name="search-industry" placeholder="">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="search-state" class="col-sm-4 control-label">状态</label>
                                <div class="col-xs-7">
                                    <select class="form-control" name="search-state" id="search-state">
                                        <option value="0"></option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-horizontal col-md-3">
                            <div class="form-group">
                                <label for="search-product" class="col-sm-4 control-label">主要产品</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="search-product" name="search-product" placeholder="">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="search-author" class="col-sm-4 control-label">填报人</label>
                                <div class="col-xs-7">
                                    <select class="form-control" name="search-author" id="search-author">
                                        <option value="0"></option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-horizontal col-md-3">
                            <div class="form-group">
                                <label for="search-time" class="col-sm-4 control-label">填报日期</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="search-time" name="search-time" placeholder="">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="form-horizontal col-md-12">
                    <table class="table table-bordered">
                        <thead>
                        <tr>
                            <th class="text-center" colspan="14">配伍计划表(<span class="year"></span>年<span class="month"></span>月第<span class="week"></span>周)</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td class="text-center">序号</td>
                            <td class="text-center">处理类别</td>
                            <td class="text-center">形态</td>
                            <td class="text-center">比例</td>
                            <td class="text-center">每日配比量</td>
                            <td class="text-center">周需求总量</td>
                            <td class="text-center">热值</td>
                            <td class="text-center">灰分</td>
                            <td class="text-center">水分</td>
                            <td class="text-center">CL</td>
                            <td class="text-center">S</td>
                            <td class="text-center">P</td>
                            <td class="text-center">F</td>
                            <td class="text-center">PH</td>
                        </tr>
                        <tr>
                            <td class="text-center">1</td>
                            <td class="text-left">废液</td>
                            <td class="text-center">废液5号</td>
                            <td class="text-right">0.5</td>
                            <td class="text-right">100</td>
                            <td class="text-right">300</td>
                            <td class="text-right">20</td>
                            <td class="text-right">10</td>
                            <td class="text-right">20</td>
                            <td class="text-right">10</td>
                            <td class="text-right">20</td>
                            <td class="text-right">10</td>
                            <td class="text-right">10</td>
                            <td class="text-right">30</td>
                        </tr>
                        <tr>
                            <td colspan="14" class="text-left">
                                合计:<span class="total"></span>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="14" class="text-left">
                                加权平均:<span class="average"></span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!--分页-->
        </div>
    </div>
    <div id="embed"></div>
</body>
<!--分页格式-->
<style type="text/css">
    .pagination > li {
        display: inline;
    }
    .inputText { float:left;
    }
    .showLi{
        float: left;
        height: 38px;
        line-height: 38px;
    }
    .selectLi{
        float: left;
        height: 38px;
        line-height: 38px;
    }
</style>

<script type="text/javascript">

    var clientId;

    /**
     * 导航问题
     * */
    $(function(){
        autoNav();
    });

    //解决底部自动导航的问题
    function autoNav(){
        //获取内容的高度
        var bodyHeight = $("body").height();
        //获取底部导航的高度
        var navHeight = $(".navbar").height();
        //获取显示屏的高度
        var iHeight = document.documentElement.clientHeight||document.body.clientHeight;
        //如果内容的高度大于（窗口的高度 - 导航的高度）,z则需要添加一个div，设置其高度
        if(bodyHeight > (iHeight - navHeight)){
            $("body").append('<div style="height: '+navHeight+'px"></div>');
        }
    }
    /**
     * 获取用户的编号
     * @param item
     * @returns {string}
     */
    function getClientId(e) {
        return e.firstElementChild.innerHTML;
    }

    /**
     * 显示客户的文件列表
     * @param e
     */
    function showClientFiles(e) {
        var clientId = getClientId(e);
        window.location.href = "archives.html?clientId=" + clientId;
    }

</script>
</html>