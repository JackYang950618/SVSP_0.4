<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jdlink.mapper.produce.WastesSummaryMapper" >
    <!--危废汇总对象映射-->
    <resultMap id="WastesSummaryRM" type="WastesSummary">
        <result property="inboundOrderId" column="inboundOrderId"/>
        <result property="outboundOrderId" column="outboundOrderId"/>
        <result property="inboundDate" column="inboundDate"/>
        <result property="outboundDate" column="outboundDate"/>
        <result property="wastesName" column="wastesName"/>
        <result property="wastesCode" column="wastesCode"/>
        <result property="beginningCount"/>
        <result property="beginningPrice"/>
        <result property="inboundCount"/>
        <result property="inboundPrice"/>
        <result property="outboundCount"/>
        <result property="outboundPrice"/>
        <result property="storageCount"/>
        <result property="storagePrice"/>
        <association property="unitDataItem" column="unitId" select="getUnitDataItem"/>
    </resultMap>

    <!--获取状态数据字典-->
    <select id="getUnitDataItem"  resultType="UnitDataItem">
        select * from datadictionaryitem where dataDictionaryItemId=#{unitId}
    </select>

    <!--获取危废汇总对象-->
    <select id="get" resultMap="WastesSummaryRM">
        select t_pl_inboundorder.inboundDate ,t_pl_inboundorderitem.inboundOrderId, t_pl_inboundorderitem.inboundOrderItemId,
          t_pl_inboundorderitem.produceCompanyId, t_pl_inboundorderitem.wastesName, t_pl_inboundorderitem.wastesCode,
          t_pl_inboundorderitem.unitId, t_pl_inboundorderitem.wastesAmount, t_pl_inboundorder.checkStateId,
          t_pl_outboundorder.outboundDate, t_pl_outboundorder.outboundOrderId, t_pl_outboundorder.outboundNumber, t_pl_outboundorder.clientId,
          t_pl_outboundorder.wasteCategory
        from (t_pl_inboundorderitem left join t_pl_inboundorder on t_pl_inboundorder.inboundOrderId=t_pl_inboundorderitem.inboundOrderId
          and (checkStateId is null or checkStateId != 69))
          left join t_pl_outboundorder on t_pl_outboundorder.inboundOrderItemId=t_pl_inboundorderitem.inboundOrderItemId and
                                          (t_pl_outboundorder.checkStateId is null or t_pl_outboundorder.checkStateId != 69)
        order by inboundDate desc
        <if test="page != null and page.start != null and page.count != null">
            limit #{page.start}, #{page.count};
        </if>
    </select>

    <!--获取入库单的数量-->
    <select id="count" resultType="int">
        select count(*) from t_pl_inboundorder where checkStateId is null or checkStateId != 69;
    </select>


</mapper>