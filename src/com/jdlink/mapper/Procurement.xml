<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jdlink.mapper.ProcurementMapper" >
   <!--添加采购-->
    <insert id="add" parameterType="Procurement">
        insert into t_pl_procurement(receiptNumber, applyMouth, demandTime, applyDepartment, proposer, divisionHead, purchasingDirector, generalManager, id1, procurementCategory,nowTIme,purchasingHead)
      values (#{receiptNumber},#{applyMouth},#{demandTime},#{applyDepartment},#{proposer},#{divisionHead},#{purchasingDirector},#{generalManager},#{id1},#{procurementCategory},NOW(),#{purchasingHead});
    </insert>
    <!--寻找最新的采购主键-->
    <select id="getNewestId" resultType="String">
        select receiptNumber from t_pl_procurement order  by receiptNumber desc;
    </select>
    <!--添加物料表-->
    <insert id="addMaterial" parameterType="Material">
        insert into t_pl_material (suppliesName, specifications, inventory, note, purchaseQuantity, demandQuantity, receiptNumber)
        values (#{suppliesName},#{specifications},#{inventory},#{note},#{purchaseQuantity},#{demandQuantity},#{receiptNumber});
    </insert>
    <!--加载采购列表-->
    <resultMap id="ProcurementRM" type="Procurement" autoMapping="true">
        <result property="receiptNumber" column="receiptNumber" javaType="String"></result>
        <collection property="materialList" column="receiptNumber" select="getMaterial" ofType="Material"></collection>
    </resultMap>
    <!--获取所有的物料信息-->
    <select id="getMaterial" resultType="Material">
        select * from t_pl_material where receiptNumber=#{receiptNumber};
    </select>
    <select id="getProcurementList" resultMap="ProcurementRM">
        select * from t_pl_procurement order by nowTime desc;;
    </select>
    <!--根据编号查询信息-->
    <select id="getProcurementListById" parameterType="String" resultMap="ProcurementRM">
        select * from t_pl_procurement where receiptNumber=#{receiptNumber} order by nowTime desc;
    </select>
    <!--高级查询-->
    <select id="searchProcurement" parameterType="Procurement" resultMap="ProcurementRM">
        select * from t_pl_procurement
        <where>
            <if test="receiptNumber!=null and receiptNumber!=''">
                and receiptNumber like binary "%"#{receiptNumber}"%"
            </if>
            <if test="applyMouth!=null and applyMouth!=''">
                and applyMouth like binary "%"#{applyMouth}"%"
            </if>
            <if test="demandTime!=null and demandTime!=''">
            and demandTime like binary "%"#{demandTime}"%"
        </if>
            <if test="applyDepartment!=null and applyDepartment!=''">
                and applyDepartment like binary "%"#{applyDepartment}"%"
            </if>
            <if test="proposer!=null and proposer!=''">
                and proposer like binary "%"#{proposer}"%"
            </if>
            <if test="divisionHead!=null and divisionHead!=''">
                and divisionHead like binary "%"#{divisionHead}"%"
            </if>
            <if test="purchasingHead!=null and purchasingHead!=''">
                and purchasingHead like binary "%"#{purchasingHead}"%"
            </if>
            <if test="purchasingDirector!=null and purchasingDirector!=''">
                and purchasingDirector like binary "%"#{purchasingDirector}"%"
            </if>
            <if test="generalManager!=null and generalManager!=''">
                and generalManager like binary "%"#{generalManager}"%"
            </if>

        </where>
    </select>
</mapper>