<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jdlink.mapper.MaterialRequisitionOrderMapper" >
    <insert id="addMaterialRequisitionOrder" parameterType="MaterialRequisitionOrder">
   insert into t_pl_materialrequisitionorder ( guardian, materialManager, picker, pickerDate, nowTime, batchingOrderId)
   values (#{guardian},#{materialManager},#{picker},#{pickerDate},NOW(),#{batchingOrder.batchingOrderId});
    </insert>
    <update id="updateBatchingOrderCheck" parameterType="MaterialRequisitionOrder">
        update t_pl_batchingorder set checkState='Picked'  where batchingOrderId=#{batchingOrder.batchingOrderId}
    </update>
    <!--更新配料单的状态-->
    <select id="total" resultType="int">
    select count(*) from t_pl_materialrequisitionorder;
</select>
    <select id="getMaterialRequisitionOrderList" resultType="String">
        select materialRequisitionId from t_pl_materialrequisitionorder order by materialRequisitionId desc ;
    </select>
    <!--获得配料单对象-->
    <resultMap id="MaterialRequisitionOrderRM" type="MaterialRequisitionOrder">
        <collection property="batchingOrder" column="batchingOrderId" ofType="BatchingOrder" select="getBatchingOrder"></collection>
    </resultMap>
    <resultMap id="BatchingOrderRM" type="BatchingOrder">
        <collection property="wasteInventory" column="inboundOrderId" ofType="WasteInventory" select="getWasteInventory"></collection>
    </resultMap>
    <resultMap id="WastesRM" type="WasteInventory">
       <association property="wastes" column="id" javaType="Wastes" select="getWastes"></association>
    </resultMap>
    <!--获得入库信息-->
    <select id="getWasteInventory" parameterType="String" resultMap="WastesRM">
         select * from t_pl_wasteinventory where  inboundOrderId=#{inboundOrderId}
    </select>
    <!--获得危废信息-->
    <resultMap id="ClientRM" type="Wastes">
        <association property="client" column="clientId" select="getClient" javaType="Client"></association>
    </resultMap>
    <select id="getWastes" parameterType="String" resultMap="ClientRM">
        select * from t_wastes where id=#{id}
    </select>
    <select id="getClient" parameterType="String" resultType="Client">
        select *from  client where clientId=#{clientId}
    </select>
    <!--获得配料单数据-->
    <select id="getBatchingOrder" resultMap="BatchingOrderRM" parameterType="String">
        select * from  t_pl_batchingorder where batchingOrderId=#{batchingOrderId}
    </select>
    <!--取得领料单对象-->
    <select id="list" resultMap="MaterialRequisitionOrderRM" >
    select * from t_pl_materialrequisitionorder;
    </select>
    <update id="updateMaterialRequisitionOrderOnId" parameterType="MaterialRequisitionOrder">
        update t_pl_materialrequisitionorder set id=#{batchingOrder.wasteInventory.wastes.id} where batchingOrderId=#{batchingOrder.batchingOrderId};
    </update>
    <!--更新领料单的单号-->
    <update id="updateMaterialRequisitionId" >
        update t_pl_materialrequisitionorder set materialRequisitionId=#{0}, nowTime=NOW() where  batchingOrderId=#{1};
    </update>
    <!--更新领料单的单号-->
    <update id="updateMaterialRequisitionId1" parameterType="MaterialRequisitionOrder">
        update t_pl_materialrequisitionorder set materialRequisitionId=#{materialRequisitionId}, nowTime=NOW() where  batchingOrderId=#{batchingOrder.batchingOrderId};
    </update>
</mapper>