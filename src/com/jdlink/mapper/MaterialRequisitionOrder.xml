<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jdlink.mapper.MaterialRequisitionOrderMapper" >
    <insert id="addMaterialRequisitionOrder" parameterType="MaterialRequisitionOrder">
   insert into t_pl_materialrequisitionorder ( guardian, materialManager, picker, pickerDate, nowTime, batchingOrderId)
   values (#{guardian},#{materialManager},#{picker},#{pickerDate},NOW(),#{batchingOrder.batchingOrderId});
    </insert>
    <select id="total" resultType="int">
    select count(*) from t_pl_materialrequisitionorder;
</select>
    <select id="getMaterialRequisitionOrderList" resultType="String"  >
        select materialRequisitionId from t_pl_materialrequisitionorder order by nowTime desc ;
    </select>
    <!--获得配料单对象-->
    <resultMap id="MaterialRequisitionOrderRM" type="MaterialRequisitionOrder">
        <collection property="batchingOrder" column="batchingOrderId" ofType="BatchingOrder" select="getBatchingOrder"></collection>
    </resultMap>
    <resultMap id="BatchingOrderRM" type="BatchingOrder">
        <collection property="wasteInventory" column="inboundOrderId" ofType="WasteInventory" select="getWasteInventory"></collection>
    </resultMap>
    <resultMap id="WastesRM" type="Wastes">
        <collection property="wastes" column="id" select="getWastes" ofType="Wastes"></collection>
    </resultMap>
    <!--获得入库信息-->
    <select id="getWasteInventory" parameterType="String" resultMap="WastesRM">
         select * from t_pl_wasteinventory where  inboundOrderId=#{inboundOrderId}
    </select>
    <!--获得危废信息-->
    <select id="getWastes" parameterType="Wastes">
        select * from t_wastes where id=#{id}
    </select>
    <!--获得配料单数据-->
    <select id="getBatchingOrder" resultMap="BatchingOrderRM" parameterType="String">
        select * from  t_pl_batchingorder where batchingOrderId=#{batchingOrderId}
    </select>
    <!--取得领料单对象-->
    <select id="list" resultMap="MaterialRequisitionOrderRM" >
    select * from t_pl_materialrequisitionorder;
    </select>
</mapper>