<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jdlink.mapper.OfficeSuppliesMapper" >

    <!--*********************************************映射集*********************************************-->

    <!--办公用品入库单映射集-->
    <resultMap id="OfficeSuppliesInboundRM" type="OfficeSuppliesInbound" autoMapping="true">
        <association property="checkStateItem" column="checkStateItemId" select="getCheckStateItem"/>
        <collection property="officeSuppliesItemList" column="inboundId" select="getInboundItemList"/>
    </resultMap>

    <!--办公用品出库单映射集-->
    <resultMap id="OfficeSuppliesOutboundRM" type="OfficeSuppliesOutbound" autoMapping="true">
        <association property="checkStateItem" column="checkStateItemId" select="getCheckStateItem"/>
        <collection property="officeSuppliesItemList" column="outboundId" select="getOutboundItemList"/>
    </resultMap>

    <!--单据条目映射集-->
    <resultMap id="OfficeSuppliesItemRM" type="OfficeSuppliesItem" autoMapping="true">
        <association property="supplier" column="supplierId" select="getSupplier"/>
        <association property="unitDataItem" column="unitDataItemId" select="getUnitDataItem"/>
        <association property="ticketRateItem" column="ticketRateItemId" select="getTicketRateItem"/>
    </resultMap>

    <!--获取供应商信息-->
    <select id="getSupplier" resultType="Supplier">
        select * from t_supplier where supplierId=#{0};
    </select>

    <!--查找数据字典条目-->
    <select id="getCheckStateItem" resultType="CheckStateItem">
        select * from datadictionaryitem where dataDictionaryItemId=#{0};
    </select>

    <!--查找数据字典条目-->
    <select id="getUnitDataItem" resultType="UnitDataItem">
        select * from datadictionaryitem where dataDictionaryItemId=#{0};
    </select>
    <!--查找数据字典条目-->
    <select id="getTicketRateItem" resultType="TicketRateItem">
        select * from datadictionaryitem where dataDictionaryItemId=#{0};
    </select>

    <!--获取入库条目-->
    <select id="getInboundItemList" resultMap="OfficeSuppliesItemRM">
        select * from t_pr_officesuppliesinbounditem where inboundId=#{inboundId};
    </select>

    <!--获取出库条目-->
    <select id="getOutboundItemList" resultMap="OfficeSuppliesItemRM">
        select * from t_pr_officesuppliesoutbounditem where outboundId=#{outboundId};
    </select>

    <!--*********************************************映射集*********************************************-->


    <!--*********************************************办公用品入库*********************************************-->

    <!--查询办公用品入库单-->
    <select id="listOfficeSuppliesInbound" resultMap="OfficeSuppliesInboundRM">
        select * from t_pr_officesuppliesinbound;
    </select>

    <!--增加办公用品入库单-->
    <insert id="addOfficeSuppliesInbound">
        insert into t_pr_officesuppliesinbound (inboundId, totalTaxPrice, totalPrice, inboundDate, createTime, checkStateItemId) values
        (#{inboundId}, #{totalTaxPrice}, #{totalPrice}, #{inboundDate}, NOW(), #{checkStateItem.dataDictionaryItemId});
        <if test="officeSuppliesItemList.size() > 0 ">
            <foreach collection="officeSuppliesItemList" item="officeSuppliesItem">
                insert into t_pr_officesuppliesinbounditem (itemId, inboundId, outboundId, supplierId, itemCode, itemName,
                itemSpecifications, unitDataItemId, itemAmount, leftAmount, taxUnitPrice, unitPrice, totalTaxPrice, totalPrice,
                inboundDate, outboundDate, ticketRateItemId, author, createTime, remark) values
                (#{officeSuppliesItem.itemId}, #{officeSuppliesItem.inboundId}, #{officeSuppliesItem.outboundId},
                #{officeSuppliesItem.supplier.supplierId}, #{officeSuppliesItem.itemCode}, #{officeSuppliesItem.itemName},
                #{officeSuppliesItem.itemSpecifications}, #{officeSuppliesItem.unitDataItem.dataDictionaryItemId},
                #{officeSuppliesItem.itemAmount}, #{officeSuppliesItem.leftAmount},
                #{officeSuppliesItem.taxUnitPrice}, #{officeSuppliesItem.unitPrice}, #{officeSuppliesItem.totalTaxPrice},
                #{officeSuppliesItem.totalPrice}, #{officeSuppliesItem.inboundDate}, #{officeSuppliesItem.outboundDate},
                #{officeSuppliesItem.ticketRateItem.dataDictionaryItemId}, #{officeSuppliesItem.author},
                NOW(), #{officeSuppliesItem.remark});
            </foreach>
        </if>
    </insert>

    <!--获取办公用品入库单中前缀匹配的单据数量-->
    <select id="getOfficeSupplierInboundCountByPrefix" resultType="int">
        select count(*) from t_pr_officesuppliesinbound where inboundId like #{0}"%";
    </select>

    <!--*********************************************办公用品入库*********************************************-->


    <!--*********************************************办公用品出库*********************************************-->

    <!--查询办公用品出库单-->
    <select id="listOfficeSuppliesOutbound" resultMap="OfficeSuppliesOutboundRM">
        select * from t_pr_officesuppliesoutbound;
    </select>

    <!--增加办公用品出库单-->
    <insert id="addOfficeSuppliesOutbound">
        insert into t_pr_officesuppliesoutbound (outboundId, totalTaxPrice, totalPrice, outboundDate, createTime, checkStateItemId) values
        (#{inboundId}, #{totalTaxPrice}, #{totalPrice}, #{outboundDate}, NOW(), #{checkStateItem.dataDictionaryItemId});
        <if test="officeSuppliesItemList.size() > 0 ">
            <foreach collection="officeSuppliesItemList" item="officeSuppliesItem">
                insert into t_pr_officesuppliesoutbounditem (itemId, inboundId, outboundId, supplierId, itemCode, itemName,
                itemSpecifications, unitDataItemId, itemAmount, leftAmount, taxUnitPrice, unitPrice, totalTaxPrice, totalPrice,
                inboundDate, outboundDate, ticketRateItemId, author, createTime, remark) values
                (#{officeSuppliesItem.itemId}, #{officeSuppliesItem.inboundId}, #{officeSuppliesItem.outboundId},
                #{officeSuppliesItem.supplier.supplierId}, #{officeSuppliesItem.itemCode}, #{officeSuppliesItem.itemName},
                #{officeSuppliesItem.itemSpecifications}, #{officeSuppliesItem.unitDataItem.dataDictionaryItemId},
                #{officeSuppliesItem.itemAmount}, #{officeSuppliesItem.leftAmount},
                #{officeSuppliesItem.taxUnitPrice}, #{officeSuppliesItem.unitPrice}, #{officeSuppliesItem.totalTaxPrice},
                #{officeSuppliesItem.totalPrice}, #{officeSuppliesItem.inboundDate}, #{officeSuppliesItem.outboundDate},
                #{officeSuppliesItem.ticketRateItem.dataDictionaryItemId}, #{officeSuppliesItem.author},
                NOW(), #{officeSuppliesItem.remark});
            </foreach>
        </if>
    </insert>

    <!--*********************************************办公用品出库*********************************************-->

    <!--*********************************************办公用品条目*********************************************-->

    <!--获取办公用品入库单条目-->
    <select id="getOfficeSuppliesInboundItemById" resultMap="OfficeSuppliesItemRM">
        select * from t_pr_officesuppliesinbounditem where itemId = #{0};
    </select>

    <!--更新办公用品条目-->
    <update id="updateOfficeSuppliesInboundItem">
        update t_pr_officesuppliesinbounditem set inboundId=#{inboundId}, outboundId=#{outboundId},
        supplierId=#{supplier.supplierId}, itemCode=#{itemCode}, itemName=#{itemName},
        itemSpecifications=#{itemSpecifications}, unitDataItemId=#{unitDataItem.dataDictionaryItemId},
        itemAmount=#{itemAmount}, leftAmount=#{leftAmount}, taxUnitPrice=#{taxUnitPrice},
        unitPrice=#{unitPrice}, totalTaxPrice=#{totalTaxPrice}, totalPrice=#{totalPrice},
        inboundDate=#{inboundDate}, outboundDate=#{outboundDate}, author=#{author}, remark=#{remark}
        where itemId=#{itemId};
    </update>

    <!--获取办公用品出库单条目-->
    <select id="getOfficeSuppliesOutboundItemById" resultMap="OfficeSuppliesItemRM">
        select * from t_pr_officesuppliesoutbounditem where itemId = #{0};
    </select>

    <!--更新办公用品条目-->
    <update id="updateOfficeSuppliesOutboundItem">
        update t_pr_officesuppliesoutbounditem set inboundId=#{inboundId}, outboundId=#{outboundId},
        supplierId=#{supplier.supplierId}, itemCode=#{itemCode}, itemName=#{itemName},
        itemSpecifications=#{itemSpecifications}, unitDataItemId=#{unitDataItem.dataDictionaryItemId},
        itemAmount=#{itemAmount}, leftAmount=#{leftAmount}, taxUnitPrice=#{taxUnitPrice},
        unitPrice=#{unitPrice}, totalTaxPrice=#{totalTaxPrice}, totalPrice=#{totalPrice},
        inboundDate=#{inboundDate}, outboundDate=#{outboundDate}, author=#{author}, remark=#{remark}
        where itemId=#{itemId};
    </update>

    <!--*********************************************办公用品条目*********************************************-->


</mapper>