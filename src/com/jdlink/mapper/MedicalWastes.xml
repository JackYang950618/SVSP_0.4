<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jdlink.mapper.MedicalWastesMapper" >
    <!--获取最新的医废出入库编号-->
    <select id="getNewId" resultType="String">
        select medicalWastesId from t_pl_medicalwastes order by (CAST(medicalWastesId AS SIGNED) )desc ;
    </select>
    <insert id="addMedicalWastes" parameterType="MedicalWastes">
        insert into  t_pl_medicalwastes(medicalWastesId, department, departmentName, adjustName, adjustDate, dateTime, thisMonthWastes, directDisposal, cookingWastes, afterCookingNumber, afterCookingInbound, thisMonthSendCooking, errorNumber, wetNumber, nowTime,equipment,checkState)
        values(#{medicalWastesId},#{department},#{departmentName},#{adjustName},#{adjustDate},Now(),#{thisMonthWastes},#{directDisposal},#{cookingWastes},#{afterCookingNumber},#{afterCookingInbound},#{thisMonthSendCooking},#{errorNumber},#{wetNumber},NOW(),#{equipment},'Enabled')
    </insert>
    <select id="loadMedicalWastesList" resultType="MedicalWastes">
        select  * from t_pl_medicalwastes  order by nowTime desc
        <if test="start != null and count != null">
            limit #{start}, #{count}
        </if>
    </select>
    <!--高级查询-->
    <select id="searchMedicalWastes" parameterType="MedicalWastes" resultType="MedicalWastes">
        select  * from t_pl_medicalwastes
        <where>
            <if test="dateTime!=null and dateTime!=''">
                and dateTime like  binary "%"#{dateTime}"%"
            </if>
            <if test="departmentName!=null and departmentName!=''">
                and departmentName like  binary "%" #{departmentName}"%"
            </if>
            <if test="dateTime=='' and  departmentName==''">
                select * from t_pl_medicalwastes
            </if>

        </where>
        order by nowTime desc
    </select>
<!--通过日期获取医废-->
    <select id="getMedicalWastesByRange" resultType="MedicalWastes">
        SELECT * FROM t_pl_medicalwastes
            <![CDATA[WHERE DATE_FORMAT(dateTime, '%Y-%m-%d') >=  DATE_FORMAT(#{0}, '%Y-%m-%d')
            AND DATE_FORMAT(dateTime, '%Y-%m-%d') <=  DATE_FORMAT(#{1}, '%Y-%m-%d')]]>;
    </select>
    <!--通过日期和处置设备-->
    <select id="getMedicalWastesByDateAndEquipment" resultType="MedicalWastes">
         SELECT * FROM t_pl_medicalwastes
            <![CDATA[WHERE DATE_FORMAT(dateTime, '%Y-%m-%d') >=  DATE_FORMAT(#{0}, '%Y-%m-%d')
            AND DATE_FORMAT(dateTime, '%Y-%m-%d') <=  DATE_FORMAT(#{1}, '%Y-%m-%d')]]> and equipment=#{2};

    </select>
   <select id="total" resultType="int">
       select  count(*) from  t_pl_medicalwastes;
   </select>
    <!--作废-->
    <update id="cancelMedicalWastes" parameterType="String">
        update t_pl_medicalwastes set checkState='Disabled',nowTime=NOW() where medicalWastesId=#{medicalWastesId};
    </update>
</mapper>